<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linkd Inc.</title>
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <!-- Preload fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@300;400;600&display=swap" as="style">
    <link rel="preload" href="https://fonts.gstatic.com/s/inconsolata/v31/QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp4U8WR32kg.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://fonts.gstatic.com/s/inconsolata/v31/QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp1U8WR32kg.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://fonts.gstatic.com/s/inconsolata/v31/QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp7c8WR32kg.woff2" as="font" type="font/woff2" crossorigin>
    <!-- Load CSS and fonts -->
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <main>
            <h1>Hey! Welcome to Linkd.</h1>
            <p class="date">February 27, 2025</p>
            <p class="announcement"><em>update: we are backed by <span class="highlight-yc"><a href="https://www.ycombinator.com/" target="_blank" rel="noopener noreferrer"><u>Y Combinator</u></a></span> as a part of their X25 batch.</em></p>
            <h2>How do you discover people?</h2>
            
            <p>We're here to find out.</p>
            
            <p>Our team building the world's first search algorithm designed around human interactions. Social networks should be centered on our <em>experiences</em>.</p>
            
            <p>It's called <b>Linkd.</b></p>

            <p class="announcement"><em>> If you're a <u>company</u> interested in people search for recruiting, teams, or leads, please directly contact us below.</em></p>
            
            <!-- <p>We're designing a lean team of ambitious engineers who love the idea of redefining interation between people and information.</p>
            
            <p>If that's you, we offer an opportunity to do your life's work and help solve the most important technical challenge of our age.</p>
            
            <p class="cta">Now is the time. Join us.</p> -->
            <!-- <br> -->
            
            <h2>About alumni.</h2>
            <p>We've began experimenting with this new medium by working with one of the most powerful forms of connections: <b>Alumni Networks.</b> Begin by searching for people who've experienced your education.</p>
            <p>Links to try out our current beta schools:</p>
            <div class="schools-list" br style="margin-bottom: 22px;">
                <p>
                    <a href="https://upenn-frontend-production.up.railway.app/" target="_blank" rel="noopener noreferrer"><u>upenn</u></a>
                    | <a href="https://utoronto.uselinkd.com/" target="_blank" rel="noopener noreferrer"><u>utoronto</u></a>
                    | <a href="https://columbia.uselinkd.com/" target="_blank" rel="noopener noreferrer"><u>columbia</u></a>
                    | <a href="https://yale.uselinkd.com/" target="_blank" rel="noopener noreferrer"><u>yale</u></a>
                    | <a href="https://stanford.uselinkd.com/" target="_blank" rel="noopener noreferrer"><u>stanford</u></a>
                    | <span><u>berkeley</u></span><i>(next!)</i>
                </p>
            </div>

            <div class="signup-section">
                <p>Want this at you school? The school with the most sign-ups in the next three days is up next!</p>
                <form class="signup-form" id="signupForm">
                    <div class="form-row">
                        <input type="text" id="name" name="name" placeholder="Full name" required>
                        <input type="email" id="email" name="email" placeholder="School email (.edu preferred)" required>
                    </div>
                    <div class="form-row">
                        <input type="text" id="school" name="school" placeholder="University/College name" required>
                        <input type="text" id="linkedin" name="linkedin" placeholder="LinkedIn URL (optional)">
                    </div>
                    <button type="submit" class="submit-button">Submit Request</button>
                </form>
                <p id="formMessage" class="form-message"></p>
            </div>
            <p class="signature">-
                <a href="https://www.linkedin.com/in/eric-mao/" target="_blank" rel="noopener noreferrer">Eric</a> & 
                <a href="https://www.linkedin.com/in/toomzheng/" target="_blank" rel="noopener noreferrer">Tom</a>
            </p>
            
            <p>for business and general inquiries: <a href="#" class="copy-email" data-email="founders@linkd.inc">founders@linkd.inc <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></a></p>
        </main>
    </div>

    <script>
        /******************************************
         * FUNCTIONAL CODE - CORE USER INTERACTIONS
         ******************************************/
        
        // Email copy functionality
        document.addEventListener('DOMContentLoaded', function() {
            const emailLink = document.querySelector('.copy-email');
            let timeoutId;

            emailLink.addEventListener('click', async function(e) {
                e.preventDefault();
                const email = this.getAttribute('data-email');
                
                try {
                    await navigator.clipboard.writeText(email);
                    const originalHTML = this.innerHTML;
                    this.textContent = 'copied!';
                    if (timeoutId) clearTimeout(timeoutId);
                    timeoutId = setTimeout(() => {
                        this.innerHTML = originalHTML;
                    }, 666);
                } catch (err) {
                    console.error('Failed to copy:', err);
                }
            });
            
            // Initialize Supabase with credentials from server
            initSupabase();
        });

        // Fetch Supabase credentials from server and initialize client
        async function initSupabase() {
            try {
                const response = await fetch('/api/config');
                if (!response.ok) {
                    throw new Error('Failed to load configuration');
                }
                
                const config = await response.json();
                
                // Initialize Supabase client with fetched credentials
                window.supabaseClient = supabase.createClient(
                    config.supabaseUrl,
                    config.supabaseKey
                );
                
                console.log('Supabase client initialized successfully');
            } catch (error) {
                console.error('Error initializing Supabase:', error);
            }
        }
        
        /******************************************
         * SECURITY & RATE LIMITING - ERROR PREVENTION
         ******************************************/
        
        // Rate limiting functionality
        const RATE_LIMIT = 1; // max submissions per hour
        const RATE_LIMIT_WINDOW = 60 * 60 * 1000; // 1 hour in milliseconds
        
        function checkRateLimit() {
            try {
                // Get stored submissions
                const storedSubmissions = localStorage.getItem('formSubmissions');
                let submissions = storedSubmissions ? JSON.parse(storedSubmissions) : [];
                
                // Clean up old entries (older than 1 hour)
                const now = Date.now();
                submissions = submissions.filter(timestamp => now - timestamp < RATE_LIMIT_WINDOW);
                
                // Check if user has exceeded limit
                if (submissions.length >= RATE_LIMIT) {
                    const oldestSubmission = submissions[0];
                    const resetTime = new Date(oldestSubmission + RATE_LIMIT_WINDOW);
                    const minutesUntilReset = Math.ceil((resetTime - now) / (60 * 1000));
                    
                    return {
                        allowed: false,
                        message: `Rate limit reached. Please try again in about ${minutesUntilReset} minute${minutesUntilReset > 1 ? 's' : ''}.`
                    };
                }
                
                // Update submissions
                submissions.push(now);
                localStorage.setItem('formSubmissions', JSON.stringify(submissions));
                
                return { allowed: true };
            } catch (e) {
                console.error('Rate limit check error:', e);
                // If localStorage fails, still allow submission
                return { allowed: true };
            }
        }
        
        /******************************************
         * FUNCTIONAL CODE - FORM HANDLING & SUBMISSION
         ******************************************/
        
        // Handle form submission
        document.getElementById('signupForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formMessage = document.getElementById('formMessage');
            formMessage.textContent = 'Submitting...';
            formMessage.className = 'form-message';
            
            /*** ERROR HANDLING - CONNECTION CHECK ***/
            // Ensure connection is available
            if (!window.fetch) {
                formMessage.textContent = 'Unable to connect to server. Please refresh and try again.';
                formMessage.className = 'form-message error';
                return;
            }
            
            /*** ERROR HANDLING - RATE LIMIT CHECK ***/
            // Check rate limit
            const rateLimitCheck = checkRateLimit();
            if (!rateLimitCheck.allowed) {
                formMessage.textContent = rateLimitCheck.message;
                formMessage.className = 'form-message error';
                return;
            }
            
            // Gather form data
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const school = document.getElementById('school').value;
            const linkedin = document.getElementById('linkedin').value;
            
            console.log('Submitting form data:', { name, email, school, linkedin });
            
            try {
                // Use the server-side endpoint to handle waitlist entries
                const response = await fetch('/api/waitlist', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name,
                        email,
                        school,
                        linkedin
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    // Customize success message
                    formMessage.textContent = `Thanks! You've registered with ${email}. We'll be in touch to launch at ${school}.`;
                    formMessage.className = 'form-message success';
                    document.getElementById('signupForm').reset();
                } else {
                    /*** ERROR HANDLING - SERVER RESPONSE ERROR ***/
                    console.error('Waitlist submission error:', result);
                    throw new Error(result.error || result.details || 'Error saving your information');
                }
            } catch (error) {
                /*** ERROR HANDLING - GENERAL FORM SUBMISSION ERROR ***/
                console.error('Error submitting form:', error);
                formMessage.textContent = 'Something went wrong: ' + (error.message || 'Unknown error');
                formMessage.className = 'form-message error';
            }
        });
    </script>
</body>
</html>